import{m as k}from"./modal-Cy1F-mbn.js";import{_ as L,i as r,r as f,c as n,b as i,a as s,F as C,d as S,e as u,t as m,j as q,k as D,o as d,f as g,w as N,v as U,l as y}from"./index-DqV6pCQQ.js";const v=1500,h=2e3;let x=null;const A={props:[],data(){return{api:{url:"https://ec-course-api.hexschool.io/v2",path:"sky030b"},loadingStatus:{id:"",deleteId:""},cart:{carts:[]},coupon:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1}},methods:{async getCart(){this.isLoading=!0;try{const e=await this.axios.get(`${this.api.url}/api/${this.api.path}/cart`);this.cart=e.data.data}catch(e){r.error(e.response.data.message,{autoClose:h})}this.isLoading=!1},async updateCart(e){this.isLoading=!0,this.loadingStatus.id=e.id;const a={product_id:e.product_id,qty:e.qty};try{const _=await this.axios.put(`${this.api.url}/api/${this.api.path}/cart/${e.id}`,{data:a});r.success(_.data.message,{autoClose:v}),await this.getCart()}catch(_){r.error(_.response.data.message,{autoClose:h})}this.loadingStatus.id="",this.isLoading=!1},async removeCartItem(e){this.isLoading=!0,this.loadingStatus.deleteId=e;try{const a=await this.axios.delete(`${this.api.url}/api/${this.api.path}/cart/${e}`);r.success(a.data.message,{autoClose:v}),await this.getCart()}catch(a){r.error(a.response.data.message,{autoClose:h})}this.loadingStatus.deleteId="",this.isLoading=!1},async deleteAllCarts(){this.isLoading=!0;try{const e=await this.axios.delete(`${this.api.url}/api/${this.api.path}/carts`);r.success(e.data.message,{autoClose:v}),await this.getCart()}catch(e){r.error(e.response.data.message,{autoClose:h})}this.isLoading=!1},async createOrder(){if(this.cart.carts.length===0){r.warn(`目前購物車為空，
請先新增商品至購物車。`,{autoClose:h});return}this.isLoading=!0;try{const e=await this.axios.post(`${this.api.url}/api/${this.api.path}/order`,{data:this.form});r.success(e.data.message,{autoClose:v}),this.$refs.form.resetForm(),await this.getCart()}catch(e){r.error(e.response.data.message,{autoClose:h})}this.isLoading=!1},confirmDeleteAllCarts(){x.show()},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的手機號碼。例如：0948723030"},init(){this.getCart(),x=new k(document.querySelector("#clearCarts"))}},watch:{isLoading(e){e?document.body.style.overflow="hidden":document.body.style.overflow=""}},mounted(){this.init()}},I={class:"container"},B={key:0,class:"text-end"},O={key:1,class:"text-end"},E=s("button",{class:"btn btn-outline-secondary",type:"button",disabled:""},"購物車內暫無商品",-1),F=[E],j={class:"modal fade",tabindex:"-1",id:"clearCarts","aria-labelledby":"clearCartsLabel"},M={class:"modal-dialog"},P={class:"modal-content"},T=D('<div class="modal-header"><h5 class="modal-title">請問是否確定要<span class="text-danger fw-bold">清空購物車</span>？</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><p>此操作將不可回復。</p></div>',2),z={class:"modal-footer"},W=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消操作",-1),G={class:"table align-middle"},H=s("thead",null,[s("tr",null,[s("th"),s("th",null,"品名"),s("th",{style:{width:"150px"}},"數量/單位"),s("th",{class:"text-end"},"單價"),s("th",{class:"text-end"},"小計")])],-1),J=["onClick"],K={key:0,class:"fas fa-spinner fa-pulse"},Q={key:0,class:"text-success"},R={class:"input-group input-group-sm align-items-center"},X={class:"input-group mb-3 align-items-center"},Y=["onUpdate:modelValue","disabled","onBlur"],Z={class:"input-group-text",id:"basic-addon2"},$={class:"text-end"},ss={key:0,class:"text-success"},es={class:"text-end"},ts={key:0,class:"text-success"},as=s("td",{colspan:"4",class:"text-end"},"總計",-1),os={class:"text-end"},ls={key:0},is=s("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),rs={class:"text-end text-success"},ns={class:"mt-5 row justify-content-center"},ds={class:"mb-3"},cs=s("label",{for:"name",class:"form-label"},"收件人姓名",-1),us={class:"mb-3"},ms=s("label",{for:"email",class:"form-label"},"Email",-1),hs={class:"mb-3"},ps=s("label",{for:"tel",class:"form-label"},"收件人手機號碼",-1),_s={class:"mb-3"},bs=s("label",{for:"address",class:"form-label"},"收件人地址",-1),fs={class:"mb-3"},gs=s("label",{for:"message",class:"form-label"},"留言",-1),ys=s("div",{class:"text-end"},[s("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function vs(e,a,_,Cs,t,c){const V=f("loadingVue"),p=f("v-field"),b=f("error-message"),w=f("v-form");return d(),n(C,null,[i(V,{active:t.isLoading},null,8,["active"]),s("div",I,[t.cart.carts.length?(d(),n("div",B,[s("button",{class:"btn btn-outline-danger",type:"button",onClick:a[0]||(a[0]=(...o)=>c.confirmDeleteAllCarts&&c.confirmDeleteAllCarts(...o))},"清空購物車")])):(d(),n("div",O,F)),s("div",j,[s("div",M,[s("div",P,[T,s("div",z,[W,s("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:a[1]||(a[1]=(...o)=>c.deleteAllCarts&&c.deleteAllCarts(...o))},"確認清除")])])])]),s("table",G,[H,s("tbody",null,[t.cart.carts?(d(!0),n(C,{key:0},S(t.cart.carts,o=>(d(),n("tr",{key:o.product.title},[s("td",null,[s("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.removeCartItem(o.id)},[t.loadingStatus.deleteId===o.id?(d(),n("i",K)):u("",!0),g(" x ")],8,J)]),s("td",null,[g(m(o.product.title)+" ",1),t.coupon?(d(),n("div",Q," 已套用優惠券 ")):u("",!0)]),s("td",null,[s("div",R,[s("div",X,[N(s("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":l=>o.qty=l,disabled:t.loadingStatus.id===o.id,onBlur:l=>c.updateCart(o)},null,40,Y),[[U,o.qty]]),s("span",Z,m(o.product.unit),1)])])]),s("td",$,[t.coupon?(d(),n("small",ss,"折扣價：")):u("",!0),g(" "+m(o.product.price),1)]),s("td",es,[t.coupon?(d(),n("small",ts,"折扣價：")):u("",!0),g(" "+m(o.final_total),1)])]))),128)):u("",!0)]),s("tfoot",null,[s("tr",null,[as,s("td",os,m(t.cart.total),1)]),t.cart.final_total!==t.cart.total?(d(),n("tr",ls,[is,s("td",rs,m(t.cart.final_total),1)])):u("",!0)])]),s("div",ns,[i(w,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:q(({errors:o})=>[s("div",ds,[cs,i(p,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":o.姓名}]),modelValue:t.form.user.name,"onUpdate:modelValue":a[2]||(a[2]=l=>t.form.user.name=l),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),i(b,{name:"姓名",class:"invalid-feedback"})]),s("div",us,[ms,i(p,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":o.email}]),modelValue:t.form.user.email,"onUpdate:modelValue":a[3]||(a[3]=l=>t.form.user.email=l),placeholder:"請輸入 Email",rules:"email|required"},null,8,["modelValue","class"]),i(b,{name:"email",class:"invalid-feedback"})]),s("div",hs,[ps,i(p,{id:"tel",name:"手機號碼",type:"tel",class:y(["form-control",{"is-invalid":o.手機號碼}]),modelValue:t.form.user.tel,"onUpdate:modelValue":a[4]||(a[4]=l=>t.form.user.tel=l),placeholder:"請輸入手機號碼",rules:c.isPhone},null,8,["modelValue","class","rules"]),i(b,{name:"手機號碼",class:"invalid-feedback"})]),s("div",_s,[bs,i(p,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":o.地址}]),modelValue:t.form.user.address,"onUpdate:modelValue":a[5]||(a[5]=l=>t.form.user.address=l),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),i(b,{name:"地址",class:"invalid-feedback"})]),s("div",fs,[gs,i(p,{as:"textarea",cols:"30",rows:"10",id:"message",name:"留言",type:"text",class:"form-control",modelValue:t.form.message,"onUpdate:modelValue":a[6]||(a[6]=l=>t.form.message=l),placeholder:"請輸入留言"},null,8,["modelValue"])]),ys]),_:1},8,["onSubmit"])])])],64)}const ws=L(A,[["render",vs]]);export{ws as default};
