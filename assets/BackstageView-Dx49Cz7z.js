import{_ as C,o as r,c as n,a as t,f as x,t as b,i as a,q as D,w as m,v as p,g as I,e as U,l as M,F as T,d as B,u as O,m as A,r as v,b as w,s as q}from"./index-cVQ3E0B3.js";import{P as j}from"./ProductsPagination-sILftQZM.js";import{m as S}from"./modal-s9vE73GR.js";const N={props:["handleModalDismiss","deleteTemp","deleteProduct"]},z={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","data-bs-backdrop":"static","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},E={class:"modal-dialog"},F={class:"modal-content border-0"},K=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},W={class:"text-danger"},G={class:"modal-footer"};function H(l,e,d,c,s,i){return r(),n("div",z,[t("div",E,[t("div",F,[K,t("div",J,[x(" 是否刪除 "),t("strong",W,b(d.deleteTemp.title),1),x(" 商品？（刪除後將無法恢復） ")]),t("div",G,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:e[0]||(e[0]=(...g)=>d.handleModalDismiss&&d.handleModalDismiss(...g))}," 取消 "),t("button",{type:"button",class:"btn btn-danger del-btn",onClick:e[1]||(e[1]=(...g)=>d.deleteProduct&&d.deleteProduct(...g)),autofocus:""}," 確認刪除 ")])])])],512)}const Q=C(N,[["render",H]]),V=1500,_=2e3,R={props:["handleModalDismiss","productTemp"],data(){return{api:{url:"https://ec-course-api.hexschool.io/v2",path:"sky030b"},product:{...this.productTemp}}},watch:{productTemp(){this.product={...this.productTemp}}},methods:{changeBigImage(){this.product.imageTempUrl&&(this.product.imageUrl=this.product.imageTempUrl),this.product.imageTempUrl=""},removeBigImage(){this.product.imageUrl=""},addSmallImage(){this.product.smallImageTempUrl&&(Object.prototype.hasOwnProperty.call(this.product,"imagesUrl")?this.product.imagesUrl.push(this.product.smallImageTempUrl):this.product.imagesUrl=[this.product.smallImageTempUrl],this.product.smallImageTempUrl="")},removeOneSmallImage(l){this.product.imagesUrl.splice(l,1)},removeAllSmallImage(){this.product.imagesUrl=[]},async uploadBigImage(){const l=document.querySelector("#upload-image-form-big"),e=document.querySelector("#file-input-big"),d=new FormData(l);if(e.value)try{const c=await this.axios.post(`${this.api.url}/api/${this.api.path}/admin/upload`,d);this.product.imageUrl=c.data.imageUrl,e.value=""}catch(c){a.error(c.response.data.message,{autoClose:_})}else a.error("請先選擇欲上傳之圖片。",{autoClose:_})},async uploadSmallImage(){const l=document.querySelector("#upload-image-form-small"),e=document.querySelector("#file-input-small"),d=new FormData(l);if(e.value)try{const c=await this.axios.post(`${this.api.url}/api/${this.api.path}/admin/upload`,d);Object.prototype.hasOwnProperty.call(this.product,"imagesUrl")?this.product.imagesUrl.push(c.data.imageUrl):this.product.imagesUrl=[c.data.imageUrl],e.value=""}catch(c){a.error(c.response.data.message,{autoClose:_})}else a.error("請先選擇欲上傳之圖片。",{autoClose:_})},async addProduct(){const l={data:this.product};try{await this.axios.post(`${this.api.url}/api/${this.api.path}/admin/product/`,l),a.success("新增成功。",{autoClose:V})}catch(e){a.error(e.response.data.message,{autoClose:_})}},async editProduct(){const l={data:this.product};try{await this.axios.put(`${this.api.url}/api/${this.api.path}/admin/product/${this.productTemp.id}`,l),a.success("修改成功。",{autoClose:V})}catch(e){a.error(e.response.data.message,{autoClose:_})}},async submitAddOrEditProduct(){Object.prototype.hasOwnProperty.call(this.productTemp,"id")?await this.editProduct():await this.addProduct(),this.updateData()},updateData(){this.$emit("update-data")}}},X={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","data-bs-backdrop":"static","aria-labelledby":"productModalLabel","aria-hidden":"true"},Y={class:"modal-dialog modal-dialog-scrollable modal-xl"},Z={class:"modal-content border-0"},$={class:"modal-header bg-dark text-white"},tt={id:"productModalLabel",class:"modal-title"},et=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ot={class:"modal-body"},st={class:"row"},lt={class:"col-sm-4"},it={class:"main-pic"},at={class:"mb-2"},dt={class:"mb-3"},rt=t("label",{for:"imageUrl",class:"form-label"},"輸入主要大圖網址",-1),nt={id:"upload-image-form-big",class:"mb-2",action:"/api/sky030b/admin/upload",enctype:"multipart/form-data",method:"post"},ct={class:"d-flex"},ut=t("input",{type:"file",id:"file-input-big",name:"file-to-upload"},null,-1),mt=["src"],pt={class:"btns d-flex"},ht={key:0,class:"col-6"},gt=t("hr",null,null,-1),bt={class:"other-pic"},_t={class:"mb-2"},ft={class:"mb-3 gap-3"},yt=t("label",{for:"imageUrl",class:"form-label"},"輸入小圖網址（點擊圖片即可刪除該張圖片）",-1),vt={id:"upload-image-form-small",class:"mb-2",action:"/api/sky030b/admin/upload",enctype:"multipart/form-data",method:"post"},wt={class:"d-flex"},Pt=t("input",{type:"file",id:"file-input-small",name:"file-to-upload"},null,-1),xt=["src","onClick"],kt={class:"btns d-flex justify-content-center"},Ut={key:0,class:"col-6"},Tt={class:"col-sm-8"},Ct={class:"mb-3"},Dt=t("label",{for:"title",class:"form-label"},"標題",-1),It={class:"row"},Mt={class:"mb-3 col-md-6"},St=t("label",{for:"category",class:"form-label"},"分類",-1),Vt={class:"mb-3 col-md-6"},Bt=t("label",{for:"price",class:"form-label"},"單位",-1),Lt={class:"row"},Ot={class:"mb-3 col-md-6"},At=t("label",{for:"origin_price",class:"form-label"},"原價",-1),qt={class:"mb-3 col-md-6"},jt=t("label",{for:"price",class:"form-label"},"售價",-1),Nt=t("hr",null,null,-1),zt={class:"mb-3"},Et=t("label",{for:"description",class:"form-label"},"產品描述",-1),Ft={class:"mb-3"},Kt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Jt={class:"mb-3"},Wt=t("label",{for:"point",class:"form-label"},"評價",-1),Gt={class:"mb-3"},Ht={class:"form-check"},Qt=["checked"],Rt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Xt={class:"modal-footer"};function Yt(l,e,d,c,s,i){var g,y;return r(),n("div",X,[t("div",Y,[t("div",Z,[t("div",$,[t("h5",tt,[t("span",null,b(s.product.id?"編輯產品":"新增產品"),1)]),et]),t("div",ot,[t("div",st,[t("div",lt,[t("div",it,[t("div",at,[t("div",dt,[rt,t("form",nt,[t("div",ct,[ut,t("input",{type:"submit",value:"送出",onClick:e[0]||(e[0]=D((...o)=>i.uploadBigImage&&i.uploadBigImage(...o),["prevent"]))})])]),m(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[1]||(e[1]=o=>s.product.imageTempUrl=o),onKeyup:e[2]||(e[2]=I((...o)=>i.changeBigImage&&i.changeBigImage(...o),["enter"]))},null,544),[[p,s.product.imageTempUrl,void 0,{trim:!0}]])]),s.product.imageUrl?(r(),n("img",{key:0,class:"img-fluid d-flex justify-content-center mx-auto",style:{"max-width":"200px","max-height":"150px"},src:s.product.imageUrl,alt:"縮圖"},null,8,mt)):U("",!0)]),t("div",pt,[t("div",{class:M({"col-6":s.product.imageUrl,"col-12":!s.product.imageUrl})},[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=(...o)=>i.changeBigImage&&i.changeBigImage(...o))},b(s.product.imageUrl?"修改圖片":"新增圖片"),1)],2),s.product.imageUrl?(r(),n("div",ht,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[4]||(e[4]=(...o)=>i.removeBigImage&&i.removeBigImage(...o))}," 刪除圖片 ")])):U("",!0)])]),gt,t("div",bt,[t("div",_t,[t("div",ft,[yt,t("form",vt,[t("div",wt,[Pt,t("input",{type:"submit",value:"送出",onClick:e[5]||(e[5]=D((...o)=>i.uploadSmallImage&&i.uploadSmallImage(...o),["prevent"]))})])]),m(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[6]||(e[6]=o=>s.product.smallImageTempUrl=o),onKeyup:e[7]||(e[7]=I((...o)=>i.addSmallImage&&i.addSmallImage(...o),["enter"]))},null,544),[[p,s.product.smallImageTempUrl,void 0,{trim:!0}]])]),(r(!0),n(T,null,B(s.product.imagesUrl,(o,k)=>(r(),n("img",{key:o,class:"img-fluid",src:o,alt:"縮圖",style:{"max-width":"100px","max-height":"150px",cursor:"pointer"},onClick:u=>i.removeOneSmallImage(k)},null,8,xt))),128))]),t("div",kt,[t("div",{class:M({"col-6":s.product.imagesUrl,"col-12":!((g=s.product.imagesUrl)!=null&&g.length)})},[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[8]||(e[8]=(...o)=>i.addSmallImage&&i.addSmallImage(...o))}," 新增圖片 ")],2),(y=s.product.imagesUrl)!=null&&y.length?(r(),n("div",Ut,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[9]||(e[9]=(...o)=>i.removeAllSmallImage&&i.removeAllSmallImage(...o))}," 清空圖片 ")])):U("",!0)])])]),t("div",Tt,[t("div",Ct,[Dt,m(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[10]||(e[10]=o=>s.product.title=o),autofocus:""},null,512),[[p,s.product.title,void 0,{trim:!0}]])]),t("div",It,[t("div",Mt,[St,m(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[11]||(e[11]=o=>s.product.category=o)},null,512),[[p,s.product.category,void 0,{trim:!0}]])]),t("div",Vt,[Bt,m(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[12]||(e[12]=o=>s.product.unit=o)},null,512),[[p,s.product.unit,void 0,{trim:!0}]])])]),t("div",Lt,[t("div",Ot,[At,m(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[13]||(e[13]=o=>s.product.origin_price=o)},null,512),[[p,s.product.origin_price,void 0,{number:!0}]])]),t("div",qt,[jt,m(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[14]||(e[14]=o=>s.product.price=o)},null,512),[[p,s.product.price,void 0,{number:!0}]])])]),Nt,t("div",zt,[Et,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[15]||(e[15]=o=>s.product.description=o)},`\r
        `,512),[[p,s.product.description,void 0,{trim:!0}]])]),t("div",Ft,[Kt,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[16]||(e[16]=o=>s.product.content=o)},`\r
        `,512),[[p,s.product.content,void 0,{trim:!0}]])]),t("div",Jt,[Wt,m(t("input",{id:"point",type:"number",min:"0",max:"5",class:"form-control",placeholder:"請輸入評價","onUpdate:modelValue":e[17]||(e[17]=o=>s.product.point=o)},null,512),[[p,s.product.point,void 0,{number:!0}]])]),t("div",Gt,[t("div",Ht,[m(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[18]||(e[18]=o=>s.product.is_enabled=o),checked:s.product.is_enabled>=1},null,8,Qt),[[O,s.product.is_enabled]]),Rt])])])])]),t("div",Xt,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:e[19]||(e[19]=(...o)=>d.handleModalDismiss&&d.handleModalDismiss(...o))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[20]||(e[20]=(...o)=>i.submitAddOrEditProduct&&i.submitAddOrEditProduct(...o))}," 確認 ")])])])],512)}const Zt=C(R,[["render",Yt]]),$t=1500,h=2e3;let f=null,P=null;const te={components:{DeleteModal:Q,ProductModal:Zt,ProductsPagination:j},data(){return{api:{url:"https://ec-course-api.hexschool.io/v2",path:"sky030b"},allProducts:{},pageProducts:{},productTemp:{},ert:{},deleteTemp:{},pagination:{},isLoading:!1}},watch:{isLoading(l){l?document.body.style.overflow="hidden":document.body.style.overflow=""}},methods:{async checkLogin(){this.isLoading=!0;try{this.getToken(),await this.axios.post(`${this.api.url}/api/user/check`),await this.getAllProducts(),await this.getPageProducts(this.pagination.current_page)}catch(l){a.error(`${l.response.data.message}。
將返回登入頁。`,{autoClose:h}),delete this.axios.defaults.headers.common.Authorization,setTimeout(()=>{this.$router.push("/login")},h+500)}this.isLoading=!1},async getAllProducts(){try{const l=await this.axios.get(`${this.api.url}/api/${this.api.path}/admin/products/all`);this.allProducts=l.data.products}catch(l){a.error(`${l.response.data.message}。
將返回登入頁。`,{autoClose:h}),delete this.axios.defaults.headers.common.Authorization,setTimeout(()=>{this.$router.push("/login")},h+500)}},async getPageProducts(l=1){try{const e=await this.axios.get(`${this.api.url}/api/${this.api.path}/admin/products?page=${l}`);this.pageProducts=e.data.products,this.pagination=e.data.pagination}catch(e){a.error(`${e.response.data.message}。
將返回登入頁。`,{autoClose:h}),delete this.axios.defaults.headers.common.Authorization,setTimeout(()=>{this.$router.push("/login")},h+500)}},async deleteProduct(){this.isLoading=!0;try{await this.axios.delete(`${this.api.url}/api/${this.api.path}/admin/product/${this.deleteTemp.id}`),a.success("刪除成功。",{autoClose:$t}),await this.getAllProducts(),await this.getPageProducts(this.pagination.current_page),this.handleModalDismiss()}catch(l){a.error(l.response.data.message,{autoClose:h})}this.isLoading=!1},async updateData(){this.isLoading=!0;try{this.handleModalDismiss(),await this.getAllProducts(),await this.getPageProducts(this.pagination.current_page)}catch(l){a.error(`${l.response.data.message}。
將返回登入頁。`,{autoClose:h}),delete this.axios.defaults.headers.common.Authorization,setTimeout(()=>{this.$router.push("/login")},h+500)}this.isLoading=!1},handleModalDismiss(){f&&f.hide(),P&&P.hide(),this.productTemp={},this.deleteTemp={}},initProductTemp(){this.productTemp={},f.show()},editProductTemp(l){this.productTemp=JSON.parse(JSON.stringify(l)),f.show()},initDeleteTemp(l){this.deleteTemp=l,P.show();const e=document.querySelector(".del-btn");setTimeout(()=>{e.focus()},500)},init(){this.checkLogin()},...A(q,["getToken"])},mounted(){this.init(),f=new S(document.querySelector("#productModal")),P=new S(document.querySelector("#delProductModal"))}},ee={class:"container"},oe={class:"row"},se={class:"col-md-12"},le={class:"d-flex justify-content-between mt-4"},ie=t("h2",null,"產品列表",-1),ae={class:"table table-hover mt-4"},de=t("thead",null,[t("tr",null,[t("th",{width:"160"},"產品名稱"),t("th",{width:"160"},"分類"),t("th",{width:"80"}," 原價 "),t("th",{width:"80"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),re={width:"160"},ne={width:"160"},ce={width:"80"},ue={width:"80"},me={width:"100"},pe={key:0,class:"text-success"},he={key:1},ge={class:"btn-group"},be=["onClick"],_e=["onClick"];function fe(l,e,d,c,s,i){const g=v("loadingVue"),y=v("ProductsPagination"),o=v("ProductModal"),k=v("DeleteModal");return r(),n(T,null,[w(g,{active:s.isLoading},null,8,["active"]),t("div",ee,[t("div",oe,[t("div",se,[t("div",le,[ie,t("button",{class:"btn btn-primary addBtn",onClick:e[0]||(e[0]=(...u)=>i.initProductTemp&&i.initProductTemp(...u)),autofocus:""}," 建立新的產品 ")]),t("table",ae,[de,t("tbody",null,[(r(!0),n(T,null,B(s.pageProducts,u=>(r(),n("tr",{key:u.title},[t("td",re,b(u.title),1),t("td",ne,b(u.category),1),t("td",ce,b(u.origin_price),1),t("td",ue,b(u.price),1),t("td",me,[u.is_enabled?(r(),n("span",pe,"啟用")):(r(),n("span",he,"未啟用"))]),t("td",null,[t("div",ge,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:L=>i.editProductTemp(u)}," 編輯 ",8,be),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:L=>i.initDeleteTemp(u)}," 刪除 ",8,_e)])])]))),128))])]),w(y,{pagination:s.pagination,"get-page-products":i.getPageProducts},null,8,["pagination","get-page-products"]),t("p",null,[x("目前有 "),t("span",null,b(Object.keys(s.allProducts).length),1),x(" 項產品")])])]),w(o,{"product-temp":s.productTemp,"handle-modal-dismiss":i.handleModalDismiss,onUpdateData:i.updateData},null,8,["product-temp","handle-modal-dismiss","onUpdateData"]),w(k,{"delete-temp":s.deleteTemp,"handle-modal-dismiss":i.handleModalDismiss,"delete-product":i.deleteProduct},null,8,["delete-temp","handle-modal-dismiss","delete-product"])])],64)}const Pe=C(te,[["render",fe]]);export{Pe as default};
